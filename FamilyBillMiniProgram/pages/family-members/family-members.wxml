<!--pages/family-members/family-members.wxml-->
<view class="container">
  <view class="header">
    <text class="title">家庭成员</text>
    <text class="subtitle" wx:if="{{members.length > 0}}">{{members.length}} 位成员</text>
  </view>

  <view class="member-list" wx:if="{{members.length > 0}}">
    <view class="member-item" wx:for="{{members}}" wx:key="id">
      <image class="member-avatar" src="{{item.avatarDisplayUrl || '/images/user.png'}}" mode="aspectFill"></image>
      <view class="member-info">
        <view class="name-row">
          <text class="member-name">{{item.nickName || item.username}}</text>
          <text class="self-tag" wx:if="{{item.userId === currentUserId}}">我</text>
        </view>
        <text class="member-role">{{item.role === 1 ? '管理员' : '成员'}}</text>
        <text class="member-joined">加入时间：{{item.joinDate}}</text>
      </view>
      <view class="member-actions">
        <button class="action-btn danger" size="mini" wx:if="{{(isAdmin && item.userId !== currentUserId)}}" bindtap="removeMember" data-id="{{item.id}}">
          移除
        </button>
        <button class="action-btn" size="mini" wx:if="{{item.userId === currentUserId || isAdmin}}" bindtap="openEditNickname" data-id="{{item.id}}">
          昵称
        </button>
      </view>
    </view>
  </view>

  <view class="empty" wx:if="{{!members.length}}">
    <text class="empty-text">暂无成员</text>
  </view>

  <!-- 昵称编辑弹窗 -->
  <view class="modal-mask" wx:if="{{showEditNicknameModal}}" bindtap="closeEditNicknameModal"></view>
  <view class="modal" wx:if="{{showEditNicknameModal}}">
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">编辑昵称</text>
        <text class="modal-close" bindtap="closeEditNicknameModal">×</text>
      </view>
      <view class="modal-body">
        <input class="modal-input" type="text" placeholder="请输入在家庭中的昵称（可留空）" value="{{editNicknameValue}}" bindinput="onEditNicknameInput" />
      </view>
      <view class="modal-footer">
        <button class="btn btn-secondary" bindtap="closeEditNicknameModal">取消</button>
        <button class="btn btn-primary" bindtap="submitEditNickname">保存</button>
      </view>
    </view>
  </view>
</view>
